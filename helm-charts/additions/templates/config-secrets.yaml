{{- if .Values.config.enabled }}
{{- $root := . }}

{{/* =================== CONFIGMAPS =================== */}}
{{- range $name, $cfg := .Values.config.configmaps }}
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ $name }}
  namespace: {{ $cfg.namespace }}
data:
  {{- if $cfg.data }}
  {{- range $k, $v := $cfg.data }}
  {{ $k }}: {{ $v | quote }}
  {{- end }}
  {{- end }}
  {{- if $cfg.dataFromFile }}
  {{- $path := $cfg.dataFromFile }}
  {{- $key := ($path | base) }}
  {{ $key }}: |
{{ tpl ($root.Files.Get $path) $root | indent 4 }}
  {{- end }}
{{- end }}

{{/* =================== SECRETS =================== */}}
{{- range $name, $cfg := .Values.config.secrets }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ $name }}
  namespace: {{ $cfg.namespace }}
type: Opaque
stringData:
  {{- if $cfg.data }}
  {{- range $k, $v := $cfg.data }}
  {{ $k }}: {{ $v | quote }}
  {{- end }}
  {{- end }}
  {{- if $cfg.dataFromFile }}
  {{- $path := $cfg.dataFromFile }}
  {{- $key := ($path | base) }}
  {{ $key }}: |
{{ tpl ($root.Files.Get $path) $root | indent 4 }}
  {{- end }}
{{- end }}

{{- end }}
